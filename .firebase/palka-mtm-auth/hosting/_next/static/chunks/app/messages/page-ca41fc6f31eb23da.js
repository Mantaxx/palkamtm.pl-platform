(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9451],{63:(e,s,t)=>{"use strict";var a=t(7260);t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},550:(e,s,t)=>{"use strict";t.d(s,{j:()=>i});var a=t(2078),r=t(2553),n=(0,a.Wp)({apiKey:"AIzaSyDA2UaWtsf8AWPuMV_ZokoruQs5-9ygWfM",authDomain:"palka-mtm-auth.firebaseapp.com",projectId:"palka-mtm-auth",storageBucket:"palka-mtm-auth.firebasestorage.app",messagingSenderId:"286714390303",appId:"1:286714390303:web:5b3cf7722e7700774d722a"}),i=(0,r.xI)(n)},1960:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(5155),r=t(1975),n=t(1983),i=t(5849),c=t(2043),l=t(5377),o=t(1450),d=t(9591),u=t(4837),m=t(9119),h=t(6956),x=t(5105),f=(0,x.A)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),p=t(508),g=(0,x.A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),v=t(5239),y=t(2115);function j(e){var s=e.conversations,t=e.onSelectConversation,r=e.selectedConversationId;return(0,a.jsx)("div",{className:"w-full md:w-80 shrink-0",children:(0,a.jsxs)(u.X,{variant:"glass",className:"h-full",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)(f,{className:"w-5 h-5"}),"Wiadomości"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===s.length?(0,a.jsxs)("div",{className:"p-4 text-center text-gray-400",children:[(0,a.jsx)(f,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Brak wiadomości"})]}):(0,a.jsx)("div",{className:"space-y-1",children:s.map(function(e){return(0,a.jsx)("button",{onClick:function(){return t(e.id)},className:"w-full p-4 text-left hover:bg-gray-700/50 transition-colors ".concat(r===e.id?"bg-gray-700/50":""),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center shrink-0",children:e.otherParticipant.image?(0,a.jsx)(v.default,{src:e.otherParticipant.image,alt:e.otherParticipant.name,width:40,height:40,className:"rounded-full"}):(0,a.jsx)(p.A,{className:"w-5 h-5 text-gray-300"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-white truncate",children:e.otherParticipant.name}),e.unreadCount>0&&(0,a.jsx)("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:e.unreadCount})]}),e.lastMessage&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm text-gray-300 truncate",children:e.lastMessage.content}),(0,a.jsx)("span",{className:"text-xs text-gray-400 ml-2 shrink-0",children:(0,m.A)(new Date(e.lastMessageAt),"HH:mm",{locale:h.A})})]})]})]})},e.id)})})})]})})}function b(e){var s=e.conversationId,t=e.otherParticipant,r=e.messages,n=e.onSendMessage,i=e.isLoading,l=void 0!==i&&i,o=e.userId,x=(0,c._)((0,y.useState)(""),2),j=x[0],b=x[1],N=(0,y.useRef)(null),w=function(){var e;null==(e=N.current)||e.scrollIntoView({behavior:"smooth"})};(0,y.useEffect)(function(){w()},[r]);var k=function(){j.trim()&&(n(j.trim()),b(""))};return s&&t?(0,a.jsx)("div",{className:"flex-1 flex flex-col",children:(0,a.jsxs)(u.X,{variant:"glass",className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center",children:t.image?(0,a.jsx)(v.default,{src:t.image,alt:t.name,width:40,height:40,className:"rounded-full"}):(0,a.jsx)(p.A,{className:"w-5 h-5 text-gray-300"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:t.email})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===r.length?(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:(0,a.jsx)("p",{children:"Brak wiadomości w tej konwersacji"})}):r.map(function(e){return(0,a.jsx)("div",{className:"flex ".concat(e.senderId===o?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(e.senderId===o?"bg-blue-500 text-white":"bg-gray-700 text-white"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:(0,m.A)(new Date(e.createdAt),"HH:mm",{locale:h.A})})]})},e.id)}),(0,a.jsx)("div",{ref:N})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-700",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:j,onChange:function(e){return b(e.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},placeholder:"Napisz wiadomość...",className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none",disabled:l}),(0,a.jsx)(d.R,{onClick:k,disabled:!j.trim()||l,className:"px-4 py-2",children:(0,a.jsx)(g,{className:"w-4 h-4"})})]})})]})}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-gray-400",children:[(0,a.jsx)(f,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"Wybierz konwersację"}),(0,a.jsx)("p",{className:"text-sm",children:"Aby rozpocząć rozmowę"})]})})}function N(e){var s=e.userId,t=(0,c._)((0,y.useState)([]),2),d=t[0],u=t[1],m=(0,c._)((0,y.useState)(),2),h=m[0],x=m[1],f=(0,c._)((0,y.useState)([]),2),p=f[0],g=f[1],v=(0,c._)((0,y.useState)(),2),N=v[0],w=v[1],k=(0,c._)((0,y.useState)(!1),2),_=k[0],S=k[1];return(0,y.useEffect)(function(){(0,r._)(function(){var e;return(0,o.YH)(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,fetch("/api/messages")];case 1:if(!(e=s.sent()).ok)return[3,3];return[4,e.json()];case 2:u(s.sent().conversations),s.label=3;case 3:return[3,5];case 4:return console.error("Error fetching conversations:",s.sent()),[3,5];case 5:return[2]}})})()},[]),(0,y.useEffect)(function(){h&&(0,r._)(function(){var e,s;return(0,o.YH)(this,function(t){switch(t.label){case 0:S(!0),t.label=1;case 1:return t.trys.push([1,5,6,7]),[4,fetch("/api/messages/".concat(h))];case 2:if(!(e=t.sent()).ok)return[3,4];return[4,e.json()];case 3:g((s=t.sent()).messages),w(s.conversation.otherParticipant),t.label=4;case 4:return[3,7];case 5:return console.error("Error fetching messages:",t.sent()),[3,7];case 6:return S(!1),[7];case 7:return[2]}})})()},[h]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-700",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Wiadomości"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Komunikuj się z innymi użytkownikami"})]}),(0,a.jsxs)("div",{className:"flex gap-6 h-[600px]",children:[(0,a.jsx)(j,{conversations:d,onSelectConversation:function(e){x(e)},selectedConversationId:h}),(0,a.jsx)(b,{conversationId:h,otherParticipant:N,messages:p,onSendMessage:function(e){return(0,r._)(function(){var t,a;return(0,o.YH)(this,function(r){switch(r.label){case 0:if(!h)return[2];r.label=1;case 1:return r.trys.push([1,5,,6]),[4,fetch("/api/messages/".concat(h),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})})];case 2:if(!(t=r.sent()).ok)return[3,4];return[4,t.json()];case 3:a=r.sent(),g(function(e){return(0,l._)(e).concat([(0,i._)((0,n._)({},a.message),{senderId:s})])}),r.label=4;case 4:return[3,6];case 5:return console.error("Error sending message:",r.sent()),[3,6];case 6:return[2]}})})()},isLoading:_,userId:s})]})]})})}var w=t(5927),k=t(63);function _(){var e=(0,w.A)(),s=e.user,t=e.loading,r=(0,k.useRouter)();return((0,y.useEffect)(function(){t||s||r.push("/auth/signin")},[s,t,r]),t)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Ładowanie..."})]})}):s?(0,a.jsx)(N,{userId:s.uid}):null}},3352:(e,s,t)=>{Promise.resolve().then(t.bind(t,1960))},4837:(e,s,t)=>{"use strict";t.d(s,{X:()=>n});var a=t(5155),r=t(5947),n=(0,t(2115).memo)(function(e){var s=e.children,t=e.className,n=e.variant,i=e.glow,c=e.hover,l=void 0===c||c,o=e.delay,d=e.intensity,u={low:{scale:1.01,y:-2},medium:{scale:1.02,y:-4},high:{scale:1.05,y:-6}}[void 0===d?"medium":d];return(0,a.jsx)(r.P.div,{initial:{opacity:0,y:50,scale:.9,rotateX:-10},animate:{opacity:1,y:0,scale:1,rotateX:0},whileHover:l?{scale:u.scale,y:u.y,rotateX:5,rotateY:5}:{},transition:{initial:{duration:.8,delay:void 0===o?0:o,type:"spring",stiffness:100},hover:{duration:.3,type:"spring",stiffness:300}},className:"\n        ".concat({default:"card",glass:"card-glass","3d":"card-3d",floating:"card-floating",gradient:"card-gradient"}[void 0===n?"default":n],"\n        ").concat(void 0!==i&&i?"animate-glow3D":"","\n        ").concat(l?"hover-3d-lift":"","\n        transform-3d perspective-1000\n        ").concat(void 0===t?"":t,"\n      "),children:s})})},5927:(e,s,t)=>{"use strict";t.d(s,{O:()=>m,A:()=>u});var a=t(1975),r=t(2043),n=t(1450),i=t(5155),c=t(2115),l=t(550),o=t(2553),d=(0,c.createContext)({user:null,loading:!0,signOut:function(){return(0,a._)(function(){return(0,n.YH)(this,function(e){return[2]})})()}}),u=function(){var e=(0,c.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function m(e){var s=e.children,t=(0,r._)((0,c.useState)(null),2),u=t[0],m=t[1],h=(0,r._)((0,c.useState)(!0),2),x=h[0],f=h[1];return(0,c.useEffect)(function(){(0,a._)(function(){var e;return(0,n.YH)(this,function(s){switch(s.label){case 0:if(!u)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,u.getIdToken()];case 2:return e=s.sent(),document.cookie="firebase-auth-token=".concat(e,"; path=/; max-age=3600; secure; samesite=strict"),[3,4];case 3:return console.error("Błąd pobierania tokenu:",s.sent()),document.cookie="firebase-auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",[3,4];case 4:return[3,6];case 5:document.cookie="firebase-auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",s.label=6;case 6:return[2]}})})()},[u]),(0,c.useEffect)(function(){var e=(0,o.hg)(l.j,function(e){m(e),f(!1)});return function(){e()}},[]),(0,i.jsx)(d.Provider,{value:{user:u,loading:x,signOut:function(){return(0,a._)(function(){return(0,n.YH)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,o.CI)(l.j)];case 1:return e.sent(),[3,3];case 2:return console.error("Błąd wylogowania:",e.sent()),[3,3];case 3:return[2]}})})()}},children:s})}},9591:(e,s,t)=>{"use strict";t.d(s,{R:()=>o});var a=t(1983),r=t(5849),n=t(5155),i=t(5947),c=t(2619),l=t.n(c),o=(0,t(2115).memo)(function(e){var s=e.children,t=e.onClick,c=e.href,o=e.type,d=e.variant,u=e.size,m=e.className,h=e.disabled,x=void 0!==h&&h,f=e.title,p=e.ariaLabel,g=e.glow,v=e.intensity,y={low:{scale:1.02,y:-2},medium:{scale:1.05,y:-4},high:{scale:1.08,y:-6}}[void 0===v?"medium":v],j="\n    ".concat({primary:"btn-primary",secondary:"btn-secondary",outline:"btn-outline",ghost:"btn-ghost",glass:"glass-morphism hover:glass-morphism-strong"}[void 0===d?"primary":d],"\n    ").concat({sm:"px-3 py-2 text-sm",md:"px-4 py-3 text-base",lg:"px-6 py-4 text-lg"}[void 0===u?"md":u],"\n    ").concat(void 0===g||g?"animate-glow3D":"","\n    ").concat(x?"opacity-50 cursor-not-allowed":"hover-3d-lift","\n    transform-3d perspective-1000\n    ").concat(void 0===m?"":m,"\n  "),b={whileHover:x?{}:{scale:y.scale,y:y.y,rotateX:5,rotateY:5},whileTap:x?{}:{scale:.98,y:0},transition:{type:"spring",stiffness:300,damping:20}};return c?(0,n.jsx)(i.P.div,(0,r._)((0,a._)({},b),{children:(0,n.jsx)(l(),{href:c,title:f,"aria-label":p,className:j,children:(0,n.jsx)("span",{className:"relative z-10",children:s})})})):(0,n.jsx)(i.P.button,(0,r._)((0,a._)({type:void 0===o?"button":o,onClick:t,disabled:x,title:f,"aria-label":p,className:j},b),{children:(0,n.jsx)("span",{className:"relative z-10",children:s})}))})}},e=>{e.O(0,[3965,9042,2190,1934,8441,9342,1255,7358],()=>e(e.s=3352)),_N_E=e.O()}]);